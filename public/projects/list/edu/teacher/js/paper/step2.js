var layer=null;layui.use(["layer"],function(){layer=layui.layer;layer.config({skin:"lq-layer",move:!1,btnAlign:"c"})});var typeText=["\u4e00\u3001\u5355\u9009\u9898","\u4e8c\u3001\u591a\u9009\u9898","\u4e09\u3001\u7b80\u7b54\u9898","\u56db\u3001\u7a0b\u5e8f\u8bbe\u8ba1\u9898"];function importTpl(){var a=$("#tpl").val();a&&layer.confirm("\u672c\u64cd\u4f5c\u5c06\u6e05\u7a7a\u5f53\u524d\u9875\u9762\u5df2\u8bbe\u5b9a\u8bd5\u9898\u8303\u56f4\u6570\u636e\uff0c\u786e\u8ba4\u5bfc\u5165\u6a21\u677f\u8bd5\u5377\u6a21\u677f\u540d\u79f0\u4e48\uff1f",{btn:["\u786e\u5b9a","\u53d6\u6d88"]},function(){layer.closeAll();$.get("?c\x3dpaper\x26m\x3dteminfo\x26id\x3d"+a,function(a){if(200==parseInt(a.error)){var b=[];a.data.forEach(function(a){var c=typeText[parseInt(a.type)-1],d=[];a.list.forEach(function(a){d.push({scs:{subject:0==a.subject_id?"null":a.subject_id,chapter:0==a.chapter_id?"null":a.chapter_id,section:0==a.section_id?"null":a.section_id},difficulty:0==a.difficulty?1:a.difficulty,score:a.score,num:a.is_num,rest:a.rest,type_id:a.type})});b.push({id:a.type,type:c,rangeList:d})});app.questionTypeList=b}},"json")})}var assist={initQuestionTypeList:function(){var a=[];typeText.forEach(function(b,c){a.push({id:c+1,type:b,rangeList:[{scs:{subject:paperData.step1Data.subject_id||"null",chapter:paperData.step1Data.chapter_id||"null",section:"null"},difficulty:1,score:2,num:3,rest:2,type_id:c+1},{scs:{subject:paperData.step1Data.subject_id||"null",chapter:paperData.step1Data.chapter_id||"null",section:"null"},difficulty:1,score:2,num:3,rest:4,type_id:c+1}]})});return a},showVerifyInfo:function(){layer.open({type:1,skin:"lq-layer",move:!1,btnAlign:"c",area:["640px","422px"],maxmin:!1,btn:["\u5173\u95ed"],content:$("#verifyQuestionTypeList").html()})}};Vue.component("questionType",{template:'\n        \x3cdiv class\x3d"type-block"\x3e\n\t\t\t\x3cdiv class\x3d"title"\x3e\n\t\t\t\t\x3cp class\x3d"h3"\x3e{{questionType.type}}\x3c/p\x3e\n\t\t\t\t\x3cp\x3e\u9898\u578b\u9898\u91cf\x3cb\x3e{{totalNum}}\x3c/b\x3e\x3c/p\x3e\n\t\t\t\t\x3cp\x3e\u9898\u578b\u5206\u503c\x3cb\x3e{{totalScore}}\x3c/b\x3e\x3c/p\x3e\n\t\t\t\x3c/div\x3e\n\t\t\t\x3crange-list :range-list\x3d"questionType.rangeList"\x3e\x3c/range-list\x3e\n\t\t\x3c/div\x3e',props:["questionType"],computed:{totalNum:function(){var a=0;this.questionType.rangeList.forEach(function(b){a+=b.num});return a},totalScore:function(){var a=0;this.questionType.rangeList.forEach(function(b){a+=b.score*b.num});return a}}});Vue.component("rangeList",{template:'\n        \x3cdiv class\x3d"range-list"\x3e\n\t\t\t\x3ctemplate v-for\x3d"(range,index) in rangeList"\x3e\n\t\t\t\t\x3crange :range\x3d"range" :index\x3d"index" :list-length\x3d"rangeList.length" @increment\x3d"incrementRange" @reduce\x3d"reduceRange"\x3e\x3c/range\x3e\n\t\t\t\x3c/template\x3e\n\t\t\x3c/div\x3e',props:["rangeList"],methods:{incrementRange:function(a,b){this.rangeList.splice(a,0,b)},reduceRange:function(a){this.rangeList.splice(a,1)}}});Vue.component("range",{template:'\n        \x3cdiv class\x3d"range flex flex-align-center"\x3e\n\t\t\t\x3cp class\x3d"range-index"\x3e\u8303\u56f4{{index+1}}\x3c/p\x3e\n            \x3cp\x3e\u79d1\u76ee-\u7ae0-\u8282\x3c/p\x3e\n\t\t\t\x3cselector :scs\x3d"range.scs" @update\x3d"updateRangeNum"\x3e\x3c/selector\x3e\n\t\t\t\x3cp\x3e\u96be\u5ea6\x3c/p\x3e\n\t\t\t\x3cselect class\x3d"difficulty-select" lay-ignore v-model\x3d"range.difficulty" @change\x3d"updateRangeNum"\x3e\n\t\t\t\t\x3coption :value\x3d"option.val" v-for\x3d"option in difficultyList"\x3e{{option.text}}\x3c/option\x3e\n\t\t\t\x3c/select\x3e\n\t\t\t\x3cp\x3e\u5355\u9898\u5206\u503c\x3c/p\x3e\n\t\t\t\x3cinput type\x3d"text" v-model.number\x3d"range.score"  class\x3d"score-input"/\x3e\n\t\t\t\x3cp\x3e\u6570\u91cf\x3c/p\x3e\n\t\t\t\x3cdiv class\x3d"num"\x3e\n\t\t\t\t\x3cinput type\x3d"text" v-model.number\x3d"range.num" class\x3d"num-input"/\x3e\n\t\t\t\t\x3cp :class\x3d"isTipshow"\x3e\u8be5\u8303\u56f4\u9898\u5e93\u9898\u91cf {{range.rest}}\x3c/p\x3e\n\t\t\t\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"handle increment" @click\x3d"incrementRange"\x3e\x3cp class\x3d"y-tip"\x3e\u590d\u5236\u8303\u56f4\x3c/p\x3e\x3c/div\x3e\n\t\t\t\x3cdiv class\x3d"handle reduce" @click\x3d"reduceRange" v-if\x3d"listLength \x3e 1"\x3e\x3cp class\x3d"y-tip"\x3e\u5220\u9664\u8303\u56f4\x3c/p\x3e\x3c/div\x3e\n\t\t\x3c/div\x3e\n    ',props:["range","index","listLength"],data:function(){return{difficultyList:paperData.difficultyList}},computed:{isTipshow:function(){return{"y-tip":!0,show:this.range.num>this.range.rest}}},methods:{incrementRange:function(){this.$emit("increment",this.index,{type_id:this.range.type_id,difficulty:this.range.difficulty,num:this.range.num,rest:this.range.rest,score:this.range.score,scs:{subject:this.range.scs.subject||"null",chapter:this.range.scs.chapter||"null",section:this.range.scs.section||"null"}})},reduceRange:function(){var a=this;layer.confirm('\u786e\u8ba4\u5220\u9664\x3cspan class\x3d"lay-confirm-danger"\x3e\u8303\u56f4\x3c/span\x3e\u4e48\uff1f',{btn:["\u786e\u5b9a","\u53d6\u6d88"]},function(){layer.closeAll();a.$emit("reduce",a.index)})},updateScore:function(a){this.range.score=a},updateRangeNum:function(a){a=this.range.scs;$.get("?c\x3dpaper\x26m\x3dquestionnum",{type_id:this.range.type_id,subject:a.subject,chapter:a.chapter,section:a.section,difficulty:this.range.difficulty},function(a){200==parseInt(a.error)&&(this.range.rest=a.data)},"json")}}});Vue.component("selector",{template:'\n        \x3cdiv class\x3d"scs-selector flex flex-align-center"\x3e\n        \t\x3cp class\x3d"y-tip" v-show\x3d"scs.subject \x3d\x3d \'null\'"\x3e\u8bf7\u9009\u62e9\u79d1\u76ee\x3c/p\x3e\n\t\t\t\x3cselect class\x3d"select-subject" lay-ignore v-model\x3d"scs.subject" @change\x3d"subjectChange"\x3e\n\t\t\t\t\x3coption value\x3d"null"\x3e--\u79d1\u76ee--\x3c/option\x3e\n\t\t\t\t\x3coption :value\x3d"option.id" v-for\x3d"option in subjectList"\x3e{{option.name}}\x3c/option\x3e\n            \x3c/select\x3e\n\t\t\t\x3cselect class\x3d"select-chapter" lay-ignore v-model\x3d"scs.chapter" @change\x3d"chapterChange"\x3e\n\t\t\t\t\x3coption  value\x3d"null"\x3e--\u7ae0--\x3c/option\x3e\n\t\t\t\t\x3coption :value\x3d"option.id" v-for\x3d"option in chapterList"\x3e{{option.name}}\x3c/option\x3e\n            \x3c/select\x3e\n\t\t\t\x3cselect class\x3d"select-section" lay-ignore v-model\x3d"scs.section"\x3e\n\t\t\t\t\x3coption value\x3d"null"\x3e--\u8282--\x3c/option\x3e\n\t\t\t\t\x3coption :value\x3d"option.id" v-for\x3d"option in sectionList"\x3e{{option.name}}\x3c/option\x3e\x3e\n\t\t\t\x3c/select\x3e\n\t\t\x3c/div\x3e',props:["scs"],data:function(){return{subjectList:paperData.treeData,chapterList:[],sectionList:[]}},watch:{scs:{handler:function(a,b){this.bindChapterList(this.scs.subject);this.bindSectionList(this.scs.chapter);this.$emit("update")},deep:!0}},created:function(){this.bindChapterList(this.scs.subject);this.bindSectionList(this.scs.chapter)},methods:{subjectChange:function(a){this.bindChapterList(a.target.value);this.scs.chapter="null";this.scs.section="null"},chapterChange:function(a){this.bindSectionList(a.target.value);this.scs.section="null"},bindChapterList:function(a){if(a&&"null"!=a){var b=this.subjectList.filter(function(b){return b.id==a});this.chapterList=0<b.length?b[0].children:[]}else this.chapterList=[]},bindSectionList:function(a){if(a&&"null"!=a){var b=this.chapterList.filter(function(b){return b.id==a});this.sectionList=0<b.length?b[0].children:[]}else this.sectionList=[]}}});var app=new Vue({el:"#app ",data:{questionTypeList:[{}],verifyQuestionTypeList:[]},created:function(){this.questionTypeList=assist.initQuestionTypeList()},computed:{finalNum:function(){var a=0;this.questionTypeList&&this.questionTypeList.forEach(function(b){b.rangeList.forEach(function(b){a+=parseInt(b.num)})});return a},finalScore:function(){var a=0;this.questionTypeList&&this.questionTypeList.forEach(function(b){b.rangeList.forEach(function(b){a+=b.score*parseInt(b.num)})});return a}},methods:{verifyPaper:function(){var a=!0,b={};try{this.questionTypeList.forEach(function(c){c.rangeList.forEach(function(c){if("null"==c.scs.subject||c.num>c.rest)throw a=!1,b;})})}catch(c){if(c!==b)throw c;}return a},subPaper:function(){this.verifyPaper()?layer.open({type:1,title:"\u63d0\u793a\u4fe1\u606f",content:'\x3cdiv class\x3d"text-c fs16" style\x3d"line-height: 22px;padding: 30px 40px;"\x3e\u6267\u884c\u4e0b\u4e00\u6b65\uff0c\u5f53\u524d\u9875\u9762\u6570\u636e\u5c06\u88ab\u4fdd\u5b58\uff0c\u5e76\u4e14\x3cspan class\x3d"c-danger"\x3e\u4e0d\u80fd\u66f4\u6539\x3c/span\x3e\uff0c\u786e\u8ba4\u6267\u884c\x3cspan class\x3d"c-danger"\x3e\u4e0b\u4e00\u6b65\x3c/span\x3e\u4e48\uff1f\x3c/div\x3e',area:["360px","230px"],btn:["\u6267\u884c\u4e0b\u4e00\u6b65","\u53d6\u6d88"],yes:function(){alert("\u63d0\u4ea4\u8868\u5355");var a=document.getElementById("tempForm");a.paper.value=JSON.stringify(self.questionTypeList);a.data.value=JSON.stringify(paperData.step1Data);a.submit()}}):layer.open({content:"\x3cdiv\x3e\u672a\u80fd\u901a\u8fc7\u6821\u9a8c\uff0c\u8bf7\u6ce8\u610f\u9875\u9762\u4e0a\u7684\u63d0\u793a\u4fe1\u606f\x3c/div\x3e"})}}});