$.fn.autoTextarea=function(a){var b={maxHeight:null,minHeight:$(this).height()},c=$.extend({},b,a);return $(this).each(function(){$(this).bind("paste cut keydown keyup focus blur",function(){var a,b=this.style;this.style.height=c.minHeight+"px";this.scrollHeight>c.minHeight&&(c.maxHeight&&this.scrollHeight>c.maxHeight?(a=c.maxHeight,b.overflowY="scroll"):(a=this.scrollHeight,b.overflowY="hidden"),b.height=a+"px")})})};function uuid(){for(var a=[],b=0;36>b;b++)a[b]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);a[14]="4";a[19]="0123456789abcdef".substr(a[19]&3|8,1);a[8]=a[13]=a[18]=a[23]="-";return a.join("")}$("textarea.editor").on("keydown",function(a){if(9==a.keyCode){a.preventDefault();a=this.selectionStart;var b=this.selectionEnd,c=window.getSelection().toString(),c="    "+c.replace(/\n/g,"\n    ");this.value=this.value.substring(0,a)+c+this.value.substring(b);this.setSelectionRange(a+4,a+c.length)}});function updateExtendItemName(){$(".code-edit-wrap .item-name").each(function(a){$(this).text($(this).closest(".layui-form-item").find(".layui-form-label").text()+"\u6e90\u7801"+(a+1))});$(".img-uploader-wrap .item-name").each(function(a){$(this).text($(this).closest(".layui-form-item").find(".layui-form-label").text()+"\u56fe\u7247"+(a+1));console.log(a)})}var $activeCodeWrap=null;function subCode(){console.log($activeCodeWrap);$activeCodeWrap.find("\x3etextarea").val($(".code-edit-dialog textarea").val());$activeCodeWrap.find("\x3eselect").val($(".code-edit-dialog select").val());closeEditor()}function closeEditor(){$(".code-edit-dialog").fadeOut()}function showImgView(a){var b=a.files[0];if(!/image\/\w+/.test(b.type))return layer.msg("\u4ec5\u652f\u6301jpg,png,bmp,jpeg,png\u683c\u5f0f\u7684\u56fe\u7247\u6587\u4ef6",{icon:5,anim:6}),!1;if(5242880<b.size)return layer.msg("\u56fe\u7247\u7684\u5927\u5c0f\u9650\u5236\u4e3a5M",{icon:5,anim:6}),a.outerHTML?a.outerHTML=a.outerHTML:a.value="",!1;var c=new FileReader;c.readAsDataURL(b);c.onload=function(c){$(a).closest(".img-uploader-wrap").addClass("editable").find(".imger").attr("src",c.target.result)}}function handleRemoveExtend(a){var b=a.parent().hasClass("img-uploader-wrap")?"?c\x3dquestions\x26m\x3ddelimg\x26id\x3d":"?c\x3dquestions\x26m\x3ddelcode\x26id\x3d";a.data("handleid")?$.ajax({url:b+a.data("handleid"),type:"get",dataType:"json",success:function(c){if(200!=c.error)return layerMsg(c.msg),!1;a.closest(".extend-item")[0].remove();updateExtendItemName()}}):(a.closest(".extend-item")[0].remove(),updateExtendItemName())}$(function(){updateExtendItemName();var a=layui.form();a.on("select(subject)",function(a){courseLinkage($("#subject"),$("#chapter"),$("#section"),'\x3coption value\x3d""\x3e\u8bf7\u9009\u62e9\x3c/option\x3e')});a.on("select(chapter)",function(a){courseLinkage($("#chapter"),$("#section"),$("#section"),'\x3coption value\x3d""\x3e\u8bf7\u9009\u62e9\x3c/option\x3e')});$("#examForm")[0].reset();a.render("select");a.on("select(examType)",function(a){window.location.href=$(a.elem).find("option:selected").data("href")});var b=$(".viewer #main").iviewer({src:"#"});$("#imgIn").click(function(){b.iviewer("zoom_by",-1)});$("#imgOut").click(function(){b.iviewer("zoom_by",1)});$("#viewerClose").click(function(){$(".img-viewer").fadeOut()});$("body").on("click",".img-uploader-wrap .handle-del,.code-edit-wrap .handle-del",function(){handleRemoveExtend($(this))});$("body").on("click",".img-uploader-wrap .handle-check",function(){var a=$(this).parent().find(".imger").attr("src");b.iviewer("loadImage",a);$(".img-viewer").fadeIn()});$("body").on("click",".code-edit-wrap .handle-window",function(){$activeCodeWrap=$(this).parent();$(".code-edit-dialog textarea").val($activeCodeWrap.find("\x3etextarea").val()).focus();$(".code-edit-dialog select").val($activeCodeWrap.find("\x3eselect").val());$(".code-edit-dialog .main-wrap").css("margin-top",($(window).height()-$(".code-edit-dialog .editor-wrap").height())/2);$(".code-edit-dialog").fadeIn()});$("body").on("click",".exam-selector span",function(){var a=$(this).closest(".layui-form-item").find(".extend-item-wrap");if(9<=a.find(".img-uploader-wrap").length||9<a.find(".code-edit-wrap").length)return layerMsg("\u6bcf\u4e2a\u5355\u5143\u201c\u6e90\u7801\u201d\u548c\u201c\u56fe\u201d\u5143\u7d20\u6570\u91cf\u4e0d\u53ef\u8d85\u8fc7 10\u4e2a"),!1;var b="",e=$(this).closest(".exam-selector").data("for"),d=0==a.find(".extend-item").length?0:parseInt(a.find(".extend-item").last().data("index"))+1;"img"==$(this).data("type")?(b+='\x3cdiv class\x3d"extend-item" data-index\x3d"'+d+'"\x3e\x3cdiv class\x3d"img-uploader-wrap"\x3e\x3cp class\x3d"item-name"\x3e\x3c/p\x3e\x3cdiv class\x3d"img-inner"\x3e\x3cdiv class\x3d"layui-icon full-block img-mask"\x3e\x26#xe64a;\x3c/div\x3e\x3cimg class\x3d"full-block imger" /\x3e\x3cinput onchange\x3d"showImgView(this)" data-verify\x3d"required" class\x3d"full-block" type\x3d"file" accept\x3d"image/gif,image/jpeg,image/jpg,image/png" name\x3d"'+e+"[img]["+d+']" /\x3e\x3cdiv class\x3d"handle handle-del layui-icon"\x3e\x26#xe640;\x3c/div\x3e\x3cdiv class\x3d"handle handle-check layui-icon"\x3e\x26#xe615;\x3c/div\x3e\x3c/div\x3e',"\x3c/div\x3e"):b+='\x3cdiv class\x3d"extend-item" data-index\x3d"'+d+'"\x3e\x3cdiv class\x3d"code-edit-wrap"\x3e\x3cp class\x3d"item-name"\x3e\x3c/p\x3e\x3ctextarea data-verify\x3d"required" class\x3d"code-editor" name\x3d"'+e+"[code]["+d+'][source]"\x3e\x3c/textarea\x3e\x3cselect name\x3d"'+e+"[code]["+d+'][type]"\x3e\x3coption value\x3d"java"\x3ejava\x3c/option\x3e\x3coption value\x3d"sql"\x3esql\x3c/option\x3e\x3coption value\x3d"js"\x3ejs\x3c/option\x3e\x3coption value\x3d"css"\x3ecss\x3c/option\x3e\x3coption value\x3d"html"\x3ehtml\x3c/option\x3e\x3coption value\x3d"c"\x3ec/c++\x3c/option\x3e\x3coption value\x3d"bash"\x3ebash\x3c/option\x3e\x3coption value\x3d"php"\x3ephp\x3c/option\x3e\x3c/select\x3e\x3cdiv class\x3d"handle handle-del layui-icon"\x3e\x26#xe640;\x3c/div\x3e\x3cdiv class\x3d"handle handle-window layui-icon"\x3e\x26#xe638;\x3c/div\x3e\x3c/div\x3e';"\x3c/div\x3e";a.append(b);updateExtendItemName()});$(document).click(function(a){a=$(a.target);a.is(".selector-drop")?$(a).parent().addClass("act"):$(".exam-selector").removeClass("act")});$("#goList").click(function(){layer.confirm("\u9898\u76ee\u5c1a\u672a\u4fdd\u5b58\uff0c\u786e\u8ba4\u8981\u8fd4\u56de\u4e48\uff1f",{btn:["\u786e\u5b9a","\u53d6\u6d88"],yes:function(){isLeaveNeedConfirm.set(!1);$(this).data("href")?window.location.href=$(this).data("href"):window.location.href="?c\x3dquestions\x26m\x3dlist"}})});$("textarea").on("keydown",function(a){if(9==a.keyCode){a.preventDefault();a=this.selectionStart;var b=this.selectionEnd,c=window.getSelection().toString(),c="    "+c.replace(/\n/g,"\n    ");this.value=this.value.substring(0,a)+c+this.value.substring(b);this.setSelectionRange(a+4,a+c.length)}});$("textarea[data-autoheight]").autoTextarea({maxHeight:800})});function layerMsg(a,b){b&&b.focus();layer.msg(a,{icon:5,anim:6,time:800})};