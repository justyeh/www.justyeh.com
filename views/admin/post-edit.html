<link href="https://cdn.bootcss.com/simplemde/1.11.2/simplemde.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/simplemde/1.11.2/simplemde.min.js"></script>

<form action="/admin/post/add" method="POST" enctype="multipart/form-data" class="form-box">
    <div class="form">
        <div class="form-group">
            <label>标题</label>
            <div class="input">
                <input type="text" name="title" autocomplete="off">
            </div>
        </div>
        <div class="form-group">
            <label>封面</label>
            <div class="input">
                <input type="hidden" id="posterVal" value="{{post.poster}}"> {{#if post.poster}}
                <label class="file with-value" style="background-image: url({{post.poster}})">
                {{else}}
                <label class="file">
                {{/if}}
                    <input type="file" accept="image/png, image/jpeg, image/gif, image/jpg" name="poster">
                    <i class="fa fa-image"></i>
                </label>
            </div>
        </div>
        <div class="form-group">
            <label>摘要</label>
            <div class="input">
                <textarea name="summary"></textarea>
            </div>
        </div>
        <div class="form-group">
            <label>标签</label>
            <div class="input">
                <div class="tag-input">
                    <input type="text" name="tags" autocomplete="off">
                </div>
            </div>
        </div>
        <div class="form-group">
            <label>正文</label>
            <div class="input">
                <textarea name="markdown" id="markdown" class="markdown"></textarea>
            </div>
        </div>
        <div class="form-group">
            <label>状态</label>
            <div class="input">
                <!--
                <div class="radio-group">
                    <label class="radio">
                        <input type="radio" name="status" value="published" {{#equals post.status 'published'}}checked="checked"{{/equals}}">
                        <span>发布</span>
                    </label>
                    <label class="radio">
                        <input type="radio" name="status" value="draft" {{#equals post.status 'draft'}}checked="checked"{{/equals}}">
                        <span>草稿</span>
                    </label>
                    <label class="radio">
                        <input type="radio" name="status" value="offline" {{#equals post.status 'offline'}}checked="checked"{{/equals}}">
                        <span>下线</span>
                    </label>
                </div>
                -->
            </div>
        </div>
        <div class="form-handle">
            <button type="submit">保存</button>
        </div>
    </div>
</form>


<script>
    //document：https://github.com/sparksuite/simplemde-markdown-editor
    var simplemde = new SimpleMDE({
        element: document.getElementById("markdown"),
        toolbar: [{
                name: "bold",
                action: SimpleMDE.toggleBold,
                className: "fa fa-bold",
                title: "加粗",
            }, {
                name: "italic",
                action: SimpleMDE.toggleItalic,
                className: "fa fa-italic",
                title: "斜体",
            }, {
                name: "heading",
                action: SimpleMDE.toggleHeadingSmaller,
                className: "fa fa-header",
                title: "标题",
            },
            "|", {
                name: "quote",
                action: SimpleMDE.toggleBlockquote,
                className: "fa fa-quote-left",
                title: "引用",
            }, {
                name: "unordered-list",
                action: SimpleMDE.toggleUnorderedList,
                className: "fa fa-quote-left",
                title: "无序列表",
            }, {
                name: "ordered-list",
                action: SimpleMDE.toggleOrderedList,
                className: "fa fa-quote-left",
                title: "有序列表",
            },
            "|", {
                name: "code",
                action: SimpleMDE.toggleCodeBlock,
                className: "fa fa-code",
                title: "代码",
            }, {
                name: "iamge",
                action: function customFunction(editor) {
                    editor.drawImage("123")
                },
                className: "fa fa fa-picture-o",
                title: "图片",
            }, {
                name: "link",
                action: SimpleMDE.drawLink,
                className: "fa fa-link",
                title: "连接",
            },
            "|", {
                name: "preview",
                action: SimpleMDE.togglePreview,
                className: "fa fa-eye no-disable",
                title: "预览",
            }, {
                name: "fullscreen",
                action: SimpleMDE.toggleFullScreen,
                className: "fa fa-arrows-alt no-disable no-mobile",
                title: "全屏",
            }, {
                name: "side-by-side",
                action: SimpleMDE.toggleSideBySide,
                className: "fa fa-columns no-disable no-mobile",
                title: "边写边看",
            }
        ]
    });
</script>

<script>
    $(function() {
        $("form").on("change", "input[type='file']", function() {
            var $file = $('.file');
            var fileInput = $(this)[0];
            var isPassVerify = true;
            var simpleFile = fileInput.files[0];
            if (!simpleFile) {
                isPassVerify = false;
            }
            if (simpleFile && simpleFile.size > 1024 * 1024 * 5) {
                alert("图片的大小限制为5M");
                isPassVerify = false;
            }
            if (!isPassVerify) {
                //清空input的值
                if (fileInput.outerHTML) {
                    fileInput.outerHTML = fileInput.outerHTML;
                } else {
                    fileInput.value = '';
                }

                if ($("#posterVal").val()) {
                    $file.css('background-image', 'url(' + $("#posterVal").val() + ')')
                } else {
                    $file.removeClass('with-value').removeAttr('style')
                }

                return false;
            }

            var reader = new FileReader();
            reader.readAsDataURL(simpleFile);
            reader.onload = function(e) {
                $file.addClass('with-value').css("background-image", "url(" + e.target.result + ")");
            };
        });
    });
</script>